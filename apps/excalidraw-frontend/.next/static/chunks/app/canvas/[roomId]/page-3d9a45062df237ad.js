(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[164],{1755:function(e,t,n){Promise.resolve().then(n.bind(n,6353))},6353:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var s=n(9324),r=n(710),o=n(8868),a=n(4647);async function l(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#FFFFFF",o=arguments.length>5?arguments[5]:void 0,{shapes:a}=await c(n),l=e.getContext("2d");if(!l)return()=>{};let u=!1,f=0,h=0,d=0,p=0;s.onmessage=t=>{let{type:n,ShapeType:s,color:r,...c}=JSON.parse(t.data);"shape"===n&&(a.push({type:s,color:r,...c}),i(a,e,l,o))},i(a,e,l,o);let y=!1,x=0,g=0,m=[],v=e=>({x:(e.offsetX-o.offsetX)/o.scale,y:(e.offsetY-o.offsetY)/o.scale}),w=c=>{if("pan"===t){u=!0,f=c.offsetX,h=c.offsetY,d=o.offsetX,p=o.offsetY,i(a,e,l,o);return}y=!0;let w=v(c);if(x=w.x,g=w.y,"pencil"===t)m=[{x:x,y:g}];else if("text"===t){let t=prompt("Enter text:");t&&(a.push({type:"text",x:x,y:g,text:t,color:r}),s.send(JSON.stringify({type:"shape",shapeType:"text",x:x,y:g,text:t,roomId:n,color:r})),i(a,e,l,o))}},k=n=>{if("pan"===t){if(!u)return;let t=n.offsetX-f,s=n.offsetY-h;o.offsetX=d+t,o.offsetY=p+s,l.setTransform(o.scale,0,0,o.scale,o.offsetX,o.offsetY),i(a,e,l,o);return}if(!y)return;i(a,e,l,o),l.strokeStyle=r;let s=v(n);if("rectangle"===t){let e=s.x-x,t=s.y-g;l.strokeRect(x,g,e,t)}else if("pencil"===t)m.push({x:s.x,y:s.y}),l.beginPath(),m.forEach((e,t)=>{0===t?l.moveTo(e.x,e.y):l.lineTo(e.x,e.y)}),l.stroke();else if("circle"===t){let e=Math.hypot(s.x-x,s.y-g);l.beginPath(),l.arc(x,g,e,0,2*Math.PI),l.stroke()}},b=c=>{if("pan"===t){u=!1,i(a,e,l,o);return}if(!y)return;y=!1;let f=v(c);if("rectangle"===t){let e=f.x-x,t=f.y-g;a.push({type:"rectangle",x:x,y:g,width:e,height:t,color:r}),s.send(JSON.stringify({type:"shape",shapeType:"rectangle",x:x,y:g,width:e,height:t,roomId:n,color:r}))}else if("pencil"===t)a.push({type:"pencil",points:[...m],color:r}),s.send(JSON.stringify({type:"shape",shapeType:"pencil",points:m,color:r,roomId:n})),m=[];else if("circle"===t){let e=Math.hypot(f.x-x,f.y-g);a.push({type:"circle",x:x,y:g,radius:e,color:r}),s.send(JSON.stringify({type:"shape",shapeType:"circle",x:x,y:g,radius:e,roomId:n,color:r}))}i(a,e,l,o)},E=t=>{t.preventDefault();let n=t.offsetX,s=t.offsetY,r=o.scale,c=r;c=t.deltaY<0?r+.1:Math.max(.1,r-.1);let u=(n-o.offsetX)/r,f=(s-o.offsetY)/r;o.offsetX=n-c*u,o.offsetY=s-c*f,o.scale=c,l.setTransform(o.scale,0,0,o.scale,o.offsetX,o.offsetY),i(a,e,l,o)};return e.addEventListener("mousedown",w),e.addEventListener("mousemove",k),e.addEventListener("mouseup",b),e.addEventListener("wheel",E),()=>{e.removeEventListener("mousedown",w),e.removeEventListener("mousemove",k),e.removeEventListener("mouseup",b),e.removeEventListener("wheel",E),s.onmessage=null}}function i(e,t,n,s){n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.width,t.height),n.fillStyle="rgba(0, 0, 0)",n.fillRect(0,0,t.width,t.height),n.setTransform(s.scale,0,0,s.scale,s.offsetX,s.offsetY),e.forEach(e=>{n.strokeStyle=e.color||"#FFFFFF",n.fillStyle=e.color||"#FFFFFF","rectangle"===e.type?n.strokeRect(e.x,e.y,e.width,e.height):"pencil"===e.type?(n.beginPath(),e.points.forEach((e,t)=>{0===t?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}),n.stroke()):"text"===e.type?(n.font="16px Arial",n.fillText(e.text,e.x,e.y)):"circle"===e.type&&(n.beginPath(),n.arc(e.x,e.y,e.radius,0,2*Math.PI),n.stroke())})}async function c(e){return console.log("".concat(r.J,"/").concat(e)),(await a.Z.get("".concat(r.J,"/api/v1/get-shapes/").concat(e))).data}var u=n(1237);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,u.Z)("RectangleHorizontal",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]]),h=(0,u.Z)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),d=(0,u.Z)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),p=(0,u.Z)("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);var y=e=>{let{socket:t,roomId:n}=e,r=(0,o.useRef)(null),[a,i]=(0,o.useState)(""),[c,u]=(0,o.useState)("#FFFFFF"),[y,x]=(0,o.useState)(100),g=(0,o.useRef)({scale:1,offsetX:0,offsetY:0}),[m,v]=(0,o.useState)({width:window.innerWidth,height:window.innerHeight});return(0,o.useEffect)(()=>{function e(){v({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,o.useEffect)(()=>{let e,s=!1;return r.current&&t&&l(r.current,a,n,t,c,g.current).then(t=>{s||(e=t)}).catch(e=>console.error(e)),()=>{s=!0,e&&e()}},[r,a,c,t,n]),(0,s.jsxs)("div",{className:"flex flex-col  h-screen pt-16",children:[(0,s.jsxs)("div",{className:"bg-[#232329] flex justify-center gap-2 py-2 z-10 sticky top-16",children:[(0,s.jsx)("button",{onClick:()=>i("rectangle"),className:"px-4 py-2 text-white bg rounded ".concat("rectangle"===a?"bg-black":""),children:(0,s.jsx)(f,{})}),(0,s.jsx)("button",{onClick:()=>i("circle"),className:"px-4 py-2 text-white rounded ".concat("circle"==a?"bg-black":""),children:(0,s.jsx)(h,{})}),(0,s.jsx)("button",{onClick:()=>i("pencil"),className:"px-4 py-2 text-white rounded ".concat("pencil"==a?"bg-black":""),children:(0,s.jsx)(d,{})}),(0,s.jsx)("button",{onClick:()=>i("pan"),className:"px-4 py-2 text-white rounded ".concat("pan"==a?"bg-black":""),children:(0,s.jsx)(p,{})}),(0,s.jsxs)("div",{className:"mt-[7px]",children:[(0,s.jsx)("label",{htmlFor:"colorPicker",className:"mr-2 text-white rounded"}),(0,s.jsx)("input",{type:"color",id:"colorPicker",value:c,onChange:e=>u(e.target.value),className:"p-1 border rounded"})]})]}),(0,s.jsx)("canvas",{className:"bg-black absolute",ref:r,width:m.width+1,height:m.height-64}),(0,s.jsx)("div",{className:"relative text-white"})]})},x=(0,n(5758).g)(e=>{let{roomId:t}=e,[n,a]=(0,o.useState)(null),[l,i]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{let e=localStorage.getItem("shapeSmithToken"),n=new WebSocket("".concat(r.M,"?token=").concat(e));n.onopen=e=>{console.log("connected to ws"),a(n),i(!0),null==n||n.send(JSON.stringify({type:"join_room",roomId:t}))},n.onclose=e=>{console.log("dis-connected from ws"),a(null),i(!1)}},[]),l&&!n)?(0,s.jsx)("div",{}):(0,s.jsx)(y,{socket:n,roomId:t})})},710:function(e,t,n){"use strict";n.d(t,{J:function(){return s},M:function(){return r}});let s="http://localhost:3003",r="ws://localhost:8080"},3535:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthContext:function(){return a},AuthProvider:function(){return l}});var s=n(9324),r=n(8868),o=n(4218);let a=(0,r.createContext)(void 0),l=e=>{let{children:t}=e,[n,l]=(0,r.useState)(!1),i=(0,o.useRouter)();return(0,r.useEffect)(()=>{localStorage.getItem("shapeSmithToken")&&l(!0)},[]),(0,s.jsx)(a.Provider,{value:{login:n,setLogin:l,handleLogOut:()=>{localStorage.removeItem("shapeSmithToken"),l(!1),i.push("/")}},children:t})}},5758:function(e,t,n){"use strict";n.d(t,{g:function(){return l}});var s=n(9324),r=n(8868),o=n(4218),a=n(3535);let l=e=>t=>{let n=(0,r.useContext)(a.AuthContext);if(!n)return null;let{login:l}=n,i=(0,o.useRouter)();return((0,r.useEffect)(()=>{l||i.push("/signin")},[l,i]),l)?(0,s.jsx)(e,{...t}):null}},1237:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(8868);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=(...e)=>e.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:l="",children:i,iconNode:c,...u},f)=>(0,s.createElement)("svg",{ref:f,...a,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:o("lucide",l),...u},[...c.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(i)?i:[i]])),i=(e,t)=>{let n=(0,s.forwardRef)(({className:n,...a},i)=>(0,s.createElement)(l,{ref:i,iconNode:t,className:o(`lucide-${r(e)}`,n),...a}));return n.displayName=`${e}`,n}},4218:function(e,t,n){"use strict";var s=n(9677);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[647,806,767,744],function(){return e(e.s=1755)}),_N_E=e.O()}]);